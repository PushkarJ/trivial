class Vulnerability
  def initialize(imagePath, imageTag, target, data)
    @data = data
    @imagePath = imagePath
    @imageTag = imageTag
    @target = target
  end

  def severity
    severity = @data["Severity"].downcase
    return severity if severity != "critical"

    if score >= 9.0
      "catastrophic"
    else
      "critical"
    end
  end

  def score
    return "unknown" if @data["CVSS"].nil?
    max_cvss_score = @data["CVSS"].inject(0) do |max_score, (source, score_data)|
      score = score_data["V3Score"] || 0
      max_score = [max_score, score].max
    end
    max_cvss_score
  end

  def image
    "#{@imagePath}:#{@imageTag}"
  end

  def target
    @target
  end

  def vulnerability_id
    @data["VulnerabilityID"]
  end

  def description
    @data["Description"]
  end

  def url
    @data["PrimaryURL"]
  end

  def title
    @data["Title"]
  end

  def package_name
    @data["PkgName"]
  end

  def distro
    find_distro = @target.match(/\((.*)\)$/)
    if (find_distro)
      find_distro[1]
    else
      ""
    end
  end

end

